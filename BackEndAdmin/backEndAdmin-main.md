## 技术选型

前提-后端写完需要部署到 Cloudflare
                                ┌───────────────────────────────┐
                                │           客户端               │
                                │  (Web / Mobile / Flutter)     │
                                │                               │
                                │ - 发起 HTTP 请求               │
                                │ - 提交登录 / CRUD / 配置      │
                                └─────────────┬─────────────────┘
                                              │ HTTP/HTTPS
                                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                           Hono Worker                             │
│                   (Cloudflare Workers 运行环境)                   │
│ ┌───────────────────────────────┐  ┌──────────────────────────┐ │
│ │         中间件层               │  │   Route 层                │ │
│ │ - JWT 验证                    │  │ - /login                  │ │
│ │ - 请求日志记录                 │  │ - /users CRUD             │ │
│ │ - 错误处理                     │  │ - /config                 │ │
│ └───────────────┬───────────────┘  └───────────────┬──────────┘ │
│                 │                                 │              │
│                 ▼                                 ▼              │
│         ┌───────────────────────────────┐ ┌────────────────────┐│
│         │       Repo 层                 │ │ KV 层             ││
│         │ - 封装数据访问接口            │ │ (token / config)  ││
│         │ - Node: Prisma + SQLite       │ │ - JWT 黑名单/白名单││
│         │ - Workers: D1 SQL             │ │ - 系统配置 / 缓存 ││
│         └───────────────┬───────────────┘ └────────────────────┘│
│                         │                                          │
│                         ▼                                          │
│                  ┌───────────────┐                                  │
│                  │     D1 数据库 │                                  │
│                  │ - 用户表      │                                  │
│                  │ - 业务表      │                                  │
│                  │ - OTA / 文件表│                                  │
│                  └───────────────┘                                  │
└────────────────────────────────────────────────────────────────────┘


数据流说明

客户端 → Worker

用户提交登录 / CRUD / 配置请求

HTTP 请求到 Hono Worker

Worker 中间件处理

JWT 验证（token 从 KV 拿黑名单/白名单）

请求日志记录

错误统一处理

Route 层分发

/login → 校验用户 → 生成 JWT → 可选写入 KV 黑名单/白名单

/users → CRUD → 调用 Repo 层访问数据库

/config → KV 存取系统配置

Repo 层

Node 阶段：Prisma + SQLite

Workers 阶段：D1 SQL

封装 CRUD / 查询 / 插入 / 更新 / 删除

KV 层

保存 JWT 黑名单 / 白名单

保存系统配置

保存临时缓存（可选）

D1 数据库

保存主业务数据：用户、设备、OTA、文件记录

可 SQL 查询、JOIN、CRUD

保证业务逻辑复用（未来可以切 Node + SQLite）

后端技术
Node + Hono + Prisma